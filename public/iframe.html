<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anthill IQ Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body, html {
            height: 100%;
            overflow: hidden;
            background-color: transparent;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Chat header */
        .chat-header {
            background: linear-gradient(135deg, #2a9a16, #228512);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chat-header h3 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        
        /* Chat messages area */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background-color: #f8fafc;
        }
        
        /* Message styles */
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.5;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            margin-bottom: 16px;
        }
        
        .user-message {
            background-color: #2a9a16;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 6px;
        }
        
        .bot-message {
            background-color: white;
            color: #333;
            margin-right: auto;
            border-bottom-left-radius: 6px;
        }
        
        /* Registration form */
        .registration-form {
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: white;
            height: 100%;
            overflow-y: auto;
        }
        
        .registration-form h4 {
            color: #2a9a16;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .form-input {
            margin-bottom: 16px;
        }
        
        .form-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .form-button {
            background-color: #2a9a16;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: background-color 0.2s ease;
        }
        
        .form-button:hover {
            background-color: #228512;
        }
        
        /* Input area */
        .chat-input-area {
            padding: 16px;
            background-color: white;
            display: flex;
            gap: 12px;
            border-top: 1px solid #eee;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 16px;
            resize: none;
            max-height: 120px;
            min-height: 48px;
            overflow-y: auto;
        }
        
        .send-button {
            background-color: #2a9a16;
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            font-size: 20px;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <h3>Anthill IQ Assistant</h3>
        </div>
        
        <!-- Messages container -->
        <div id="chat-messages" class="chat-messages"></div>
        
        <!-- Registration form (initially visible) -->
        <div id="registration-form" class="registration-form">
            <h4>Quick Registration</h4>
            <div class="form-input">
                <label for="name">Your Name</label>
                <input type="text" id="name" placeholder="Enter your name" required>
            </div>
            <div class="form-input">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" placeholder="Enter your phone number" required>
            </div>
            <button id="register-button" class="form-button">Start Chat</button>
        </div>
        
        <!-- Input area (initially hidden) -->
        <div id="chat-input-area" class="chat-input-area hidden">
            <textarea id="chat-input" class="chat-input" placeholder="Type your message..." rows="1"></textarea>
            <button id="send-button" class="send-button">âž¤</button>
        </div>
    </div>
    
    <script>
        // Configuration - Replace with your deployed Vercel URL
        const CONFIG = {
            API_URL: 'https://your-vercel-deployment-url.vercel.app/api/chat',
            REGISTRATION_API_URL: 'https://your-vercel-deployment-url.vercel.app/api/register-user'
        };
        
        // Initialize state
        let state = {
            sessionId: null,
            userId: null,
            isRegistered: false
        };
        
        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const registrationForm = document.getElementById('registration-form');
        const chatInputArea = document.getElementById('chat-input-area');
        const nameInput = document.getElementById('name');
        const phoneInput = document.getElementById('phone');
        const registerButton = document.getElementById('register-button');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        
        // Helper functions
        function sendMessage(message) {
            if (!message.trim()) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Clear input
            chatInput.value = '';
            
            // Send to backend
            fetch(CONFIG.API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: message,
                    user_id: state.userId,
                    session_id: state.sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                // Add bot response to chat
                addMessageToChat(data.response, 'bot');
                
                // Save session ID if provided
                if (data.session_id) {
                    state.sessionId = data.session_id;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                addMessageToChat("I'm sorry, I'm having trouble connecting. Please try again later.", 'bot');
            });
        }
        
        function registerUser(name, phone) {
            fetch(CONFIG.REGISTRATION_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    phone: phone
                })
            })
            .then(response => response.json())
            .then(data => {
                // Save user ID and session ID
                state.userId = data.user_id;
                state.sessionId = data.session_id;
                state.isRegistered = true;
                
                // Hide registration form, show chat
                registrationForm.classList.add('hidden');
                chatInputArea.classList.remove('hidden');
                
                // Add welcome message
                addMessageToChat(`Welcome, ${name}! How can I help you today?`, 'bot');
            })
            .catch(error => {
                console.error('Error:', error);
                addMessageToChat("I'm sorry, I couldn't register you. Please try again.", 'bot');
            });
        }
        
        function addMessageToChat(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
            messageElement.textContent = text;
            chatMessages.appendChild(messageElement);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Event listeners
        registerButton.addEventListener('click', function() {
            const name = nameInput.value;
            const phone = phoneInput.value;
            
            if (name && phone) {
                registerUser(name, phone);
            } else {
                alert('Please fill in all fields');
            }
        });
        
        sendButton.addEventListener('click', function() {
            const message = chatInput.value;
            sendMessage(message);
        });
        
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const message = this.value;
                sendMessage(message);
            }
        });
        
        // Auto-resize textarea
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    </script>
</body>
</html> 